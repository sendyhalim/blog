<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Sendy Halim">
  <meta name="description" content="Sendy Halim&#39;s blog">
  <title>
    
      Unit Testing: Organizing Test Directories and Files
    
  </title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/default.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/navigation.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/highlight-js.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/image.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/post.css" />
</head>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80328765-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-80328765-1');
  </script>



  <body>
    <div id="content">
      <nav>
  <a href="https://blog.wavvel.com">
    <span class="arrow">←</span> Home
  </a>
</nav>



<div class="post">
  <h1 class="title">Unit Testing: Organizing Test Directories and Files</h1>

  <div class="headline">
    <div>
      2023-10-21

    </div>
    <div>
      <div class="tag-list-container">
  
  <span class="tag">
    #software-engineering
  </span>
  
  <span class="tag">
    #best-practices
  </span>
  
  <span class="tag">
    #unit-testing
  </span>
  
</div>

    </div>
  </div>

  <div class="post-body">
    <h3 id="motivation"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#motivation" aria-label="Anchor link for: motivation">#</a>
Motivation</h3>
<p>It's common for a function to have many positive and negative cases,
which means it demands more testing code.
Testing code will grow large, at some point it will be challenging to navigate and read the testing codebase.
Organizing unit tests will help you to maintain the testing code,
it also lowers the mental effort maintaining the codebase, this is true
not only for unit tests but also applies generally.</p>
<p>These are the common goals that you can use to organize your unit tests:</p>
<ol>
<li>Visibility. Visibility means it's easy to search and navigate through the testing files.</li>
<li>Readability. Readability focuses on the testing file content and structure.</li>
</ol>
<h3 id="visibility-directory-and-file-path-structure"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#visibility-directory-and-file-path-structure" aria-label="Anchor link for: visibility-directory-and-file-path-structure">#</a>
Visibility: Directory and file path structure</h3>
<p>Some modern programming languages have conventions on organizing test directories and files, following the standard conventions should be the best thing to do.</p>
<ul>
<li>Go has a convention to put test code in a different file under <a href="https://go.dev/doc/tutorial/add-a-test">the same source code directory</a> e.g. <code>foo.go</code> will have test file <code>foo_test.go</code></li>
<li>Rust has a convention to put the tests together in the file <a href="https://doc.rust-lang.org/book/ch11-03-test-organization.html#:~:text=You&#x27;ll%20put%20unit%20tests,code%20that%20they&#x27;re%20testing.">source code</a></li>
</ul>
<p>If the language has no convention, I usually mirror the test file path to the source code file path.
Suppose that you have <code>src/finance/tax-calculator.js</code>, there will be a test file with path <code>test/unit/finance/tax-calculator.spec.js</code>,
notice that the test file path has a different prefix and file extension with the source code file (<code>src/*</code> vs <code>test/unit/*</code>, <code>.js</code> vs <code>.spec.js</code>),
this is a convention that I follow because it's easier to search and keep the main codebase source directory clean.</p>
<pre><code>▾ src&#x2F;
  ▾ finance&#x2F;
      tax-calculator.js
▾ test&#x2F;
  ▾ finance&#x2F;
      tax-calculator.spec.js
</code></pre>
<h3 id="readability-testing-code-file-structure"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#readability-testing-code-file-structure" aria-label="Anchor link for: readability-testing-code-file-structure">#</a>
Readability: Testing code file structure</h3>
<p>Testing code file structure is meant to ease navigation within the testing codebase.
A straightforward approach that I take is to represent 1 module/class with 1 testing code file.
Within the file I group test cases per module function/class method, the grouping is done based on the test
framework that you use. Grouping test cases per module function will help you to extract out
the test cases for that specific function, here are the examples in JS &amp; Java</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">&#x2F;&#x2F; file: test&#x2F;finance&#x2F;tax-calculator.spec.js
&#x2F;&#x2F; The example uses mocha as the most popular test framework in nodejs.
&#x2F;&#x2F; This test file contains test cases under tax-calculator module,
&#x2F;&#x2F; each function will have test cases grouped together within a describe block.
describe(&#x27;&#x2F;finance&#x2F;tax-calculator&#x27;, () =&gt; {
  describe(&#x27;.calculateTaxForExpat()&#x27;, () =&gt; {
    context(&#x27;when given 100k salary&#x27;, ...);
    context(&#x27;when given 200k salary&#x27;, ...);
  });

  describe(&#x27;.calculateTaxForCitizen()&#x27;, () =&gt; {
    ...
  });

  describe(&#x27;.calculateTaxForSmallBusiness()&#x27;, () =&gt; {
    ...
  });
});
</code></pre>
<pre data-lang="java" class="language-java "><code class="language-java" data-lang="java">&#x2F;&#x2F; This is the Java equivalent of the JS example above
&#x2F;&#x2F; file: TaxCalculatorSpec.java
class TaxCalculatorSpec {
  &#x2F;&#x2F; In Java we group test cases by leveraging nested classes,
  &#x2F;&#x2F; CalculateTaxForExpat class will have test cases
  &#x2F;&#x2F; for TaxCalculator::calculateTaxForExpat() method
  class CalculateTaxForExpat {
    ..
  }

  class CalculateTaxForCitizen {
    ..
  }

  class CalculateTaxForSmallBusiness {
    ..
  }
}

</code></pre>
<h3 id="readability-splitting-large-testing-code-file"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#readability-splitting-large-testing-code-file" aria-label="Anchor link for: readability-splitting-large-testing-code-file">#</a>
Readability: Splitting large testing code file</h3>
<p>Maintaining a large testing file is challenging, it's like maintaining a code file that has thousands of lines of code,</p>
<p>There are 3 test file components that can be separated quite easily:</p>
<ul>
<li>Target functions that are being tested.</li>
<li>Testing data (fixtures).</li>
<li>Common test utilities.</li>
</ul>
<h4 id="separating-unit-tests-per-target-function"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#separating-unit-tests-per-target-function" aria-label="Anchor link for: separating-unit-tests-per-target-function">#</a>
Separating unit tests per target function</h4>
<p>It's generally a good idea to start splitting a large test file into multiple test files, 1 test file should cover only 1 target function/method.
The definition of a large test file should be similar to the definition of a large business logic module/class in your engineering team.
I personally use 2k lines of code threshold to start the splitting.</p>
<p>Suppose <code>test/unit/finance/tax-calculator.spec.js</code> is more than 2k lines of code and it contains 3 target functions: <code>calculateTaxForExpat()</code>, <code>calculateTaxForCitizen()</code>, and <code>calculateTaxForSmallBusiness()</code>. We would have 3 test files after splitting:</p>
<pre><code>▾ src&#x2F;
  ▾ finance&#x2F;
      tax-calculator.js
▾ test&#x2F;
  ▾ finance&#x2F;
    ▾ tax-calculator&#x2F;
        calculate-tax-for-expat.spec.js
        calculate-tax-for-citizen.spec.js
        calculate-tax-for-small-business.spec.js
</code></pre>
<h4 id="separating-unit-test-data-fixtures"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#separating-unit-test-data-fixtures" aria-label="Anchor link for: separating-unit-test-data-fixtures">#</a>
Separating unit test data (fixtures)</h4>
<p>When test input data are more than 10% of the testing code, I recommend moving
the test data into a separate fixture file. It's easier to navigate through the testing code if the testing logic is concise.</p>
<pre><code>▾ test&#x2F;
  ▾ finance&#x2F;
    ▾ tax-calculator&#x2F;
        calculate-tax-for-expat.spec.js
        calculate-tax-for-expat.fixture.js
        calculate-tax-for-citizen.spec.js
        calculate-tax-for-citizen.fixture.js
        calculate-tax-for-small-business.spec.js
        calculate-tax-for-small-business.fixture.js
</code></pre>
<h4 id="separating-common-test-utilities"><!-- Customize https://github.com/getzola/zola/blob/master/components/templates/src/builtins/anchor-link.html -->
<a class="zola-anchor" href="#separating-common-test-utilities" aria-label="Anchor link for: separating-common-test-utilities">#</a>
Separating common test utilities</h4>
<p>We can separate common test logic into a separate code module/class so it's easier to reuse it.
If the reused test common logic is only a couple of lines and rarely reused across test cases then better to keep it within the same test file,
otherwise, we can group common logic further based on where it's reused:</p>
<ol>
<li>Reused common logic in many unit test cases in the same testing file. We can put it in the same directory as the test class/module:</li>
</ol>
<pre><code>▾ test&#x2F;
  ▾ finance&#x2F;
    ▾ tax-calculator&#x2F;
        ...
        calculate-tax-for-expat.utilities.js
        ...
</code></pre>
<ol start="2">
<li>Reused common logic in the same target class/module will have a separate file in the class/module directory.</li>
</ol>
<pre><code>▾ test&#x2F;
  ▾ finance&#x2F;
    ▾ tax-calculator&#x2F;
        common.utilities.js
        ...
</code></pre>
<ol start="3">
<li>Reused common logic in the across target class/module will have a separate common directory and files in root test directory.</li>
</ol>
<pre><code>▾ test&#x2F;
  ▾ common-utilities&#x2F;
      test-loop.js
      fake-db.js
  ▾ finance&#x2F;
      ...
</code></pre>

  </div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wavvel'; // Required - Replace '<example>' with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>

    <footer id="footer">
  <p class="small">
    © Copyright 2023 Sendy Halim
  </p>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script src="https://blog.wavvel.com/assets/js/highlight.js" type="text/javascript"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
</script>

  </body>
</html>
