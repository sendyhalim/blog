<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Sendy Halim">
		<meta name="description" content="Sendy Halim&#39;s blog">
    <title>Swift MIME Type Detection with Swime</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://sendyhalim.github.io/blog/assets/css/default.css" />
    <link rel="stylesheet" type="text/css" href="https://sendyhalim.github.io/blog/assets/css/navigation.css" />
    <link rel="stylesheet" type="text/css" href="https://sendyhalim.github.io/blog/assets/css/highlight-js.css" />
    <link rel="stylesheet" type="text/css" href="https://sendyhalim.github.io/blog/assets/css/image.css" />
    <link rel="stylesheet" type="text/css" href="https://sendyhalim.github.io/blog/assets/css/post.css" />
  </head>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80328765-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-80328765-1');
  </script>

  <body>
    <div id="content">
      <nav>
  <a href="/">
    <span class="arrow">←</span> Home
  </a>
</nav>



<div class="post">
  <h1 class="title">Swift MIME Type Detection with Swime</h1>

  <div class="headline">
    <div>
      2017-04-26

    </div>
    <div>
      <div class="tag-list-container">
  
  <span class="tag">
    #swift
  </span>
  
  <span class="tag">
    #mimetype
  </span>
  
  <span class="tag">
    #libraries
  </span>
  
  <span class="tag">
    #swime
  </span>
  
</div>

    </div>
  </div>

  <div class="post-body">
    <p>A month ago I found myself scouring GitHub for a Swift plugin
to detect mime type based on magic bytes. I did find <a href="https://github.com/onevcat/MimeType">MimeType</a>,
unfortunately it extracts the mime type from a file path or url extension.
Knowing that no one hadn't created a mime type checking library for Swift, I set
a to-do list to learn about mime type checking, hoping that I could contribute to the open source
community. My first attempt was to understand how to read file bytes in Swift.
Below is my best attempt after going through Apple docs and some examples from stackoverflow.</p>
<pre><code>let path = &quot;/path/to/file&quot;
let url = URL(fileURLWithPath: path, isDirectory: false)
let data = try! Data(contentsOf: url)
</code></pre>
<p>Okay now I've got the file represented in <code>Data</code> struct, how do I read the bytes?
It turns out we need to allocate an array of <code>UInt8</code> as the bytes container
then pass it to <code>Data.copyBytes(to:count:)</code></p>
<pre><code>let bytesCount = 10

// Bytes need to mutable.
var bytes = [UInt8](repeating: 0, count: bytesCount)

// Copy file bytes to `bytes` variable
data.copyBytes(to: &amp;bytes, count: bytesCount)
</code></pre>
<p>Next is the hard part, some of the <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">magic bytes specification</a>
need to be treated differently, for example we need to read bytes 0-3 then jump to bytes 30-57 to check
for <code>application/epub+zip</code>.
<a href="https://github.com/sendyhalim/swime">Swime</a> comes to aid this. I took the awesome implementation of
Sindresorhus <a href="https://github.com/sindresorhus/file-type">file type</a> library and rewrote it in Swift with
some added features.</p>
<p>A typical mime type check operation with Swime would look like this</p>
<pre><code>import Swime

let path = &quot;/path/to/some-file.jpg&quot;
let url = URL(fileURLWithPath: path, isDirectory: false)
let data = try! Data(contentsOf: url)
let mimeType = Swime.mimeType(data: data)

mimeType?.type == .jpg // true
mimeType! // MimeType(mime: &quot;image/jpeg&quot;, ext: &quot;jpg&quot;, type: .jpg)

switch mimeType?.type {
  case .jpg?:
    ....
  case .png?:
    ....
  case .wmv?:
    ....

  case ...
}
</code></pre>
<p>Please feel free to open an issue or pull request if there's a feature
that would be a great addition to <a href="https://github.com/sendyhalim/swime">Swime</a>!</p>
<p class="image-container">
  <img
    src="https://media.giphy.com/media/Zw3oBUuOlDJ3W/giphy.gif" alt="Beer Toast!"
    class="medium-size">
</p>

  </div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wavvel'; // Required - Replace '<example>' with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>

    <footer id="footer">
      <p class="small">
        © Copyright 2020 Sendy Halim
      </p>
      <p class="small">
        <a href="https://github.com/sendyhalim/blog" target="_blank">Source Code</a>
      </p>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://sendyhalim.github.io/blog/assets/js/highlight.js" type="text/javascript"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
  </body>
</html>
