<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Sendy Halim">
  <meta name="description" content="Sendy Halim&#39;s blog">
  <title>
    
      War Story: Accidentally Ran A Database Update Without Where Clause
    
  </title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/default.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/navigation.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/highlight-js.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/image.css" />
  <link rel="stylesheet" type="text/css" href="https://blog.wavvel.com/assets/css/post.css" />
</head>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80328765-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-80328765-1');
  </script>



  <body>
    <div id="content">
      <nav>
  <a href="https://blog.wavvel.com">
    <span class="arrow">‚Üê</span> Home
  </a>
</nav>



<div class="post">
  <h1 class="title">War Story: Accidentally Ran A Database Update Without Where Clause</h1>

  <div class="headline">
    <div>
      2023-09-30

    </div>
    <div>
      <div class="tag-list-container">
  
  <span class="tag">
    #software-engineering
  </span>
  
  <span class="tag">
    #day-to-day
  </span>
  
  <span class="tag">
    #best-practices
  </span>
  
  <span class="tag">
    #war-stories
  </span>
  
</div>

    </div>
  </div>

  <div class="post-body">
    <h2 id="what-happened">What Happened</h2>
<p>Back in 2019 I was in a very good mood that the product launch was quite smooth in the past months.
I got report that there were calculation bugs affecting some of the data. The bug was reproducible locally, I skimmed at the code and just kind of knew where the miscalculation happened in the code,
my confident was high and my coffee tasted good on that day!</p>
<p>Long story short, I submitted the bug fix to be reviewed and then deployed
the fix to our testing environment. I tested it manually in concurrent to the QA testing process, the fix worked
well on test environment and I deployed it directly to the prod, the fix was confirmed to work on production as well,
I could see incoming data was calculated correctly.</p>
<p>As the finisher, I move forward to update the old data that was incorrect prior the fix.
I was already in the company network, so I connected to the database through psql
and start writing the update statement. I couldn't remember what was going on in my mind but
I typed the closing semicolon as soon as I reached the update statement, I had not typed the filter, it was the
worst thing that could happen.</p>
<pre><code>update a_table set x = x * 1.1; -- &lt;enter&gt;
</code></pre>
<p>I didn't even notice, looking at my sql statement that I ran, it was kind of hanging there on psql ü§®. It's just like your typical query when it's processing a lot of data then
it returned the updated rows, showing tens of thousands of data had been updated, this was a small DB, but still tens of thousands is a lot to
fix.</p>
<p>Thankfully I was able to pull a quick sql to update all the data again, I was lucky that I applied DML that's easy to reverse.</p>
<pre><code>update a_table set x = x &#x2F; 1.1; -- &lt;enter&gt;
</code></pre>
<p>Putting cherry on the top, there was no new data coming in. The query worked and
I can still keep my job, also big thanks to my coffee that I made for myself.
Completing the day, I wrote the query with the filter (where clause) first then the DML to complete the day
with a very good lesson that I keep up until now.</p>
<h2 id="what-went-wrong-and-lesson-learned">What Went Wrong and Lesson Learned</h2>
<p>For the reflection, what I can think of that went wrong:</p>
<ul>
<li>I should've asked for sql review from my peers.</li>
<li>I should've written the filter first before doing any mutations.</li>
</ul>
<p>From that day on, I always ask for a sql review and always write filter,
this is a very good lesson and I'm very grateful for it.
I hope you learn something from the war story.</p>

  </div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wavvel'; // Required - Replace '<example>' with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>

    <footer id="footer">
  <p class="small">
    ¬© Copyright 2023 Sendy Halim
  </p>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script src="https://blog.wavvel.com/assets/js/highlight.js" type="text/javascript"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
</script>

  </body>
</html>
